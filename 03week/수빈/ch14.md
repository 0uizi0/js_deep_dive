# 14장 전역 변수의 문제점

## 14.1 변수의 생명 주기

- 지역 변수의 생명주기

  - 함수 호출시 생성, 함수 종료시 소멸 => 생명주기가 있기 때문에 메모리공간 정리 가능
    - 함수 호출 직후 함수 몸체에서 코드 실행전에 자바스크립트 엔진에 의해 먼저 실행 > undefined 초기화 > 함수 몸체 실행되면서 변수에 값 할당 > 함수 종료 후 변수 소멸하여 생명주기 종료
  - 함수 실행동안만 유효 : 함수의 생명주기 == 지역변수 생명주기
  - 그러나! 함수보다 오래 생존하는 경우도 있음
    - 변수는 메모리공간을 식별하기위해 붙인 이름임으로 공간이 확보된 시점부터 공간이 해제되어 가용 메모리 풀에 반환되는 시점까지임
    - 함수가 생성한 스코프에 지역변수가 등록되고, 이 스코프는 렉시컬 환경이라 부르는 물리적 실체가 있음. 따라서 변수는 스코프가 소멸될때까지 유효
    - 아무것도 참조X, 가비지 콜렉터에 의해 해제되어 가용 메모리 풀에 반환<br/>
      => 변수를 누군가 참조하면 생명주기 소멸안됨. 스코프도 마찬가지임 (클로저 와 관련..)
  - 호이스팅 : 스코프 단위로 동작 > 호이스팅은 변수선언이 스코프의 선두로 끌어올려진것처럼 동작

    ```js
    var x = "global";

    function foo() {
      console.log(x); // undefined 뜸. 하단의 x가 스코프단위로 호이스팅되는데 초기화단계인 undefined가 먼저 설정되기 때문
      var x = "local";
    }

    foo();
    console.log(x); // global
    ```

- 전역 변수의 생명주기
  - 전역 변수 선언은 런타임 이전 단계에 자바스크립트 엔진에 의해 먼저 실행
  - 전역 코드는 함수와는 다르게 명시적 호출없이 실행 ~ 더이상 실행할 문이 없으면 종료 > var 키워드 선언한 변수는 전역 객체의 프로퍼티임
    - 전역 변수 생명주기 == 전역 객체의 생명주기

## 14.2 전역 변수의 문제점
* 암묵적 결합 : 모든 코드가 전역변수를 참조하고 변경하도록 허용 > 가독성 저하, 의도하지 않은 재할당 발생
* 긴생명주기 : 메모리 리소스 소비
* 스코프 체인 상에서 종점에 존재 : 검색속도 저하
* 네임스페이스 오염 : 파일이 분리되어있어도 전역 스코프를 공유하여 중복 이름선언시 문제 발생

## 14.3 전역변수의 사용을 억제하는 방법
* 변수의 스코프는 좁을수록 좋음 : 지역변수 권장!
  * 즉시실행함수 : 단한번만 호출, 모든 변수는 즉시 실행함수의 지역변수가 됨
  * 네임스페이스 객체 : 전역에 네임스페이스 역할을 담당할 객체 생성 후 변수를 프로퍼티에 추가
  ```js
  var MYAPP = {};
  MYAPP.name = 'Lee';
  MYAPP.person = {
    address : 'seoul',
    age : 27
  }
  console.log(MYAPP.name) // Lee
  console.log(MYAPP.person.age) // 27
  ```
    * 그러나 유용하진 않음 : 네임스페이스객체자체가 전역변수에 할당됨
  * 모듈패턴 : 클래스를 모방하여 변수,함수를 즉시실행함수로 감싸 하나의 모듈 생성 (클로저기반동작)
    * 특징
      * 캡슐화 : 객체의 상태를 나타내는 프로퍼티 & 프로퍼티를 참조하고 조작가능한 동작인 메소드를 하나로 묶음
        * 은닉 : 객체의 특정 프로퍼티나 메서드를 감출 목적으로 사용하기도 함
      * 접근제한자 (public, private, protected) 없음
  * es6 모듈 : 사용시 전역변수 사용X > 파일 자체의 독자적인 모듈 스코프를 제공<br/>
    => var 변수는 window 객체의 프로퍼티X, 전역변수 X
    `<script type="module" src="lib.mjs"></script>`


---

# 면접 예상 질문

## 💥 전역변수를 무분별하게 사용시 어떤 문제점이 있나요?
모든 코드가 전역변수를 참조하고 변경하도록 암묵적 결합이 일어나서 의도치 않은 재할당이 발생되거나 가독성이 저하되고, 긴 생명주기로 인해 메모리 리소스를 많이 소비합니다. 또한 스코프 체인이 가장 마지막에 위치하여 검색속도가 저하되고, 네임스페이스가 오염될 수 있습니다.

## 💥 변수의 생명주기에 대해서 설명해주세요.
함수의 지역변수의 경우 함수가 호출되면 생성되어 초기화 단계를 거치고, 값이 할당되며 추후 함수 종료시 소멸됩니다.
전역변수의 경우 자바스크립트엔진에 의해 런타임 이전에 먼저 실행되며 추후 더이상 실행할 문이 없으면 종료되어 소멸합니다.

## 💥 전역변수 사용을 개선하는 방법에 대해 말해주세요
즉시실행함수를 사용하여 지역변수로 변환하거나 네임스페이스객체를 생성하여 변수를 해당 객체의 프로퍼티로 추가하는 방법 등이 있다

---

# 이야기하고 싶은 것

